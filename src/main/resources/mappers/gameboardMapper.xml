<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="game.site.wep.gameboardMapper">
	<insert id="insert" useGeneratedKeys="true" keyProperty="boardnum" >
		insert into gameboard(subject,content,regidate,companyname,price,RS,companylogo, thumbnail,setupfile,kategorie)
		values (#{subject},#{content},#{regidate},#{companyname},#{price},#{RS},#{companylogo},#{thumbnail},#{setupfile},#{kategorie})
		
	
	</insert>

	<select id="selectTotalCnt" resultType="int">
		select count(*) boardnum from gameboard
		WHERE removeyn = 'n'
	
	</select>

	<select id="selctList" resultType="Gameboard">
	select * from gameboard
		where removeyn = 'n' 
		<include refid="find"/>
		order by boardnum desc
		limit #{startNum} , #{perPage}
	</select>
	
	<select id="selectOne" resultType="Gameboard">
		select * from gameboard
		where boardnum =#{boardnum}
	
	</select>
	
	
	<!-- 구입맵퍼 -->
	
	<insert id="gamebuy">
		insert into trade(userid,boardnum,payment)
		values (#{userid},#{boardnum},#{payment})
		
	
	</insert>
	
	<!-- 총판매량 업데이트 -->
	<update id="sellcnt">
		update gameboard
		set sellcnt = sellcnt+ 1
		where boardnum = #{boardnum}
	
	</update>
	
	
	<select id="tradelog" resultType="int">
		select  count(*) cnt
		from trade
		WHERE userid = #{userid}
		and boardnum = #{boardnum}
	
	</select>
	
	<!-- 검색 조건문 -->
	<sql id="find">
		<if test="findkey == 'subject'">
			AND subject LIKE concat( '%' ,#{findvalue}, '%')
		</if>
		
		<if test="findkey == 'kategorie'">
			AND kategorie LIKE concat('%' ,#{findvalue}, '%')
		</if>
	
	</sql>
	
</mapper>